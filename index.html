<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MATH ‡∏Å‡∏£‡∏¥‡πä‡∏á - ‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏≠‡∏ô‡∏∏‡∏û‡∏±‡∏ô‡∏ò‡πå</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" xintegrity="sha384-n8MVd4RsNIU0KOVEMeaOVTGsevhrBKQyawqgW7u2bwCfB2Qx8PEVASc/ZBDIq82q" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" xintegrity="sha384-XjKyOOlVwcjN_1pqcMlIENsrjsG/s4esfgCSb2KfsO4vyvyktDbFInMTxptIluJO" crossorigin="anonymous"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Kanit', sans-serif; }
        
        /* Style adjustments for KaTeX */
        .math-display, .math-formula {
            font-size: 1.25rem; /* Adjust font size for better readability */
        }
        .choice-btn .math-display {
             font-size: 1.1rem;
             display: flex;
             align-items: center;
             justify-content: flex-start;
             width: 100%;
        }

        .pulse-animation { animation: pulse 2s infinite; }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .fade-out {
            animation: fadeOut 1s ease-out forwards;
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0.3; }
        }
        .timer-warning {
            animation: timerBlink 0.5s infinite;
        }
        @keyframes timerBlink {
            0%, 100% { background-color: #ef4444; }
            50% { background-color: #dc2626; }
        }
        .highlight-box {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-left: 4px solid #f59e0b;
        }
        .info-icon {
            animation: bounce 2s infinite;
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div id="cheatWarning" class="fixed inset-0 bg-red-600 text-white z-50 flex items-center justify-center hidden">
        <div class="text-center p-8">
            <div class="text-6xl mb-4">‚ö†Ô∏è</div>
            <h2 class="text-2xl font-bold mb-4">‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥!</h2>
            <p class="text-lg">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏™‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</p>
            <button onclick="hideCheatWarning()" class="mt-4 bg-white text-red-600 px-6 py-2 rounded-lg font-semibold">
                ‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö
            </button>
        </div>
    </div>

    <div id="welcomeScreen" class="container mx-auto px-4 py-8">
        <div class="max-w-3xl mx-auto bg-white rounded-2xl shadow-xl p-8">
            <div class="text-center mb-8">
                 <div class="text-6xl mb-4 info-icon">üìê</div>
                <h1 class="text-4xl font-bold text-indigo-600 mb-2">MATH ‡∏Å‡∏£‡∏¥‡πä‡∏á</h1>
                <p class="text-xl text-gray-600">‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏≠‡∏ô‡∏∏‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Ç‡∏≠‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô</p>
                <p class="text-sm text-gray-500 mt-2">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ä‡∏±‡πâ‡∏ô‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 6</p>
            </div>

            <div class="bg-gradient-to-r from-indigo-50 to-purple-50 p-6 rounded-xl mb-6 border border-indigo-200">
                <div class="flex items-center mb-4">
                    <span class="text-2xl mr-3">üìã</span>
                    <h3 class="text-xl font-bold text-indigo-800">‡∏Ñ‡∏≥‡∏ä‡∏µ‡πâ‡πÅ‡∏à‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</h3>
                </div>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <div class="highlight-box p-4 rounded-lg">
                            <div class="flex items-center mb-2">
                                 <span class="text-xl mr-2">‚è∞</span>
                                <span class="font-bold text-amber-800">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</span>
                            </div>
                             <ul class="text-sm text-amber-700 space-y-1 ml-6">
                                <li>‚Ä¢ <strong>‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 10 ‡∏Ç‡πâ‡∏≠</strong> ‡πÄ‡∏ß‡∏•‡∏≤‡∏Ç‡πâ‡∏≠‡∏•‡∏∞ <strong>1 ‡∏ô‡∏≤‡∏ó‡∏µ 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</strong></li>
                                <li>‚Ä¢ ‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤ = <strong>‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</strong> üîî</li>
                            </ul>
                        </div>
                        
                         <div class="bg-green-50 p-4 rounded-lg border-l-4 border-green-400">
                            <div class="flex items-center mb-2">
                                <span class="text-xl mr-2">üéØ</span>
                                <span class="font-bold text-green-800">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å</span>
                            </div>
                            <ul class="text-sm text-green-700 space-y-1 ml-6">
                                <li>‚Ä¢ <strong>Chill:</strong> ‡∏Ç‡πâ‡∏≠ 1-3 (‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô)</li>
                                <li>‚Ä¢ <strong>Normal:</strong> ‡∏Ç‡πâ‡∏≠ 4-7 (‡∏û‡∏´‡∏∏‡∏ô‡∏≤‡∏°‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô)</li>
                                <li>‚Ä¢ <strong>Pro Max:</strong> ‡∏Ç‡πâ‡∏≠ 8-10 (‡∏ú‡∏•‡∏Ñ‡∏π‡∏ì/‡∏ú‡∏•‡∏´‡∏≤‡∏£/‡∏•‡∏π‡∏Å‡πÇ‡∏ã‡πà)</li>
                             </ul>
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                         <div class="bg-yellow-50 p-4 rounded-lg border-l-4 border-yellow-400">
                            <div class="flex items-center mb-2">
                                <span class="text-xl mr-2">üí°</span>
                                 <span class="font-bold text-yellow-800">‡∏£‡∏∞‡∏ö‡∏ö‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠</span>
                            </div>
                            <ul class="text-sm text-yellow-700 space-y-1 ml-6">
                                 <li>‚Ä¢ <strong>Hint 50%:</strong> ‡∏ï‡∏±‡∏î 2 ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</li>
                                <li>‚Ä¢ <strong>Hint 25%:</strong> ‡∏ï‡∏±‡∏î 1 ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</li>
                                <li>‚Ä¢ <strong>+30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ:</strong> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏Ç‡πâ‡∏≠‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</li>
                                 <li>‚Ä¢ ‚ö†Ô∏è <strong>‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</strong> ‡∏ï‡∏•‡∏≠‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö</li>
                            </ul>
                        </div>
                        
                         <div class="bg-red-50 p-4 rounded-lg border-l-4 border-red-400">
                            <div class="flex items-center mb-2">
                                <span class="text-xl mr-2">üö´</span>
                                 <span class="font-bold text-red-800">‡∏Ç‡πâ‡∏≠‡∏´‡πâ‡∏≤‡∏°</span>
                            </div>
                            <ul class="text-sm text-red-700 space-y-1 ml-6">
                                 <li>‚Ä¢ <strong>‡∏´‡πâ‡∏≤‡∏°‡∏™‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠</strong> ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏õ‡∏≠‡∏∑‡πà‡∏ô</li>
                                <li>‚Ä¢ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞<strong>‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÇ‡∏à‡∏ó‡∏¢‡πå‡πÉ‡∏´‡∏°‡πà</strong>‡∏´‡∏≤‡∏Å‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö</li>
                            </ul>
                         </div>
                    </div>
                </div>
                
                <div class="mt-6 bg-blue-50 p-4 rounded-lg border border-blue-200">
                    <div class="flex items-center justify-center mb-2">
                        <span class="text-xl mr-2">üèÜ</span>
                        <span class="font-bold text-blue-800">‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÇ‡∏ö‡∏ô‡∏±‡∏™</span>
                    </div>
                    <div class="text-center text-sm text-blue-700">
                         <strong>‡πÄ‡∏£‡πá‡∏ß + ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ Hint + ‡∏ñ‡∏π‡∏Å‡∏°‡∏≤‡∏Å = ‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡πÄ‡∏û‡∏¥‡πà‡∏°!</strong> ‚ú®
                    </div>
                </div>
            </div>

            <div class="space-y-4 mb-6">
                 <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠ - ‡∏™‡∏Å‡∏∏‡∏•</label>
                    <input type="text" id="studentName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠ - ‡∏™‡∏Å‡∏∏‡∏•">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏´‡πâ‡∏≠‡∏á ‡∏°.6/...</label>
                        <input type="text" id="studentClass" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏°.6/1">
                     </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</label>
                        <input type="number" id="studentNumber" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà">
                     </div>
                </div>
            </div>

            <div class="text-center">
                <button id="startQuizBtn" class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-8 py-3 rounded-xl font-semibold text-lg hover:from-indigo-600 hover:to-purple-700 transform hover:scale-105 transition-all duration-200">
                     üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö
                </button>
            </div>

            <div class="mt-6 text-center text-sm text-gray-500">
                <p id="motivationalQuote">üí™ "‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏∏‡∏ç‡πÅ‡∏à‡∏™‡∏π‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏•‡∏∏‡∏¢‡πÄ‡∏•‡∏¢!" üí™</p>
            </div>
            
            <div class="mt-8 text-center text-xs text-gray-400">
                <p>Vibe by Canva AI ‚ö°Ô∏è Built by TLeTotsaphol</p>
            </div>

        </div>
    </div>

    <div id="quizScreen" class="hidden">
        <div class="bg-gradient-to-r from-indigo-600 to-purple-700 shadow-lg p-4">
            <div class="container mx-auto flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <span class="text-3xl animate-pulse">üìê</span>
                     <div>
                        <h2 class="font-bold text-xl text-white">MATH ‡∏Å‡∏£‡∏¥‡πä‡∏á</h2>
                        <p class="text-sm text-indigo-100" id="studentInfo"></p>
                    </div>
                </div>
                 <div class="flex items-center space-x-6">
                    <div class="text-center bg-white/20 backdrop-blur-sm rounded-lg p-3">
                        <div class="text-xs text-indigo-100">‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà</div>
                        <div class="font-bold text-2xl text-white" id="questionNumber">1/10</div>
                     </div>
                    <div class="text-center bg-white/20 backdrop-blur-sm rounded-lg p-3">
                        <div class="text-xs text-indigo-100">‡πÄ‡∏ß‡∏•‡∏≤‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ</div>
                        <div class="font-bold text-2xl text-yellow-300" id="timer">90</div>
                         <div class="text-xs text-indigo-100">‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-gray-200 h-2">
             <div id="progressBar" class="bg-gradient-to-r from-green-400 to-blue-500 h-2 transition-all duration-300" style="width: 10%"></div>
        </div>

        <div class="container mx-auto px-4 py-8">
            <div class="max-w-4xl mx-auto">
                <div class="bg-white rounded-2xl shadow-xl p-8" id="questionCard">
                    <div class="text-center mb-6">
                        <div class="text-4xl mb-2" id="questionEmoji">ü§î</div>
                        <h3 class="text-xl font-semibold text-gray-800 mb-4">‡∏´‡∏≤‡∏≠‡∏ô‡∏∏‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Ç‡∏≠‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ</h3>
                        <div class="bg-blue-50 p-6 rounded-xl">
                             <div class="math-formula text-blue-800" id="questionText">
                                </div>
                         </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6" id="answerChoices">
                        </div>

                    <div class="flex justify-center space-x-4 mb-6" id="hintContainer">
                        <button id="hint50" onclick="useHint(50)" class="bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 text-white px-6 py-3 rounded-xl font-semibold flex items-center space-x-2 transition-all duration-200 transform hover:scale-105 shadow-lg">
                            <span>üí°</span>
                            <span>Hint 50%</span>
                        </button>
                         <button id="hint25" onclick="useHint(25)" class="bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white px-6 py-3 rounded-xl font-semibold flex items-center space-x-2 transition-all duration-200 transform hover:scale-105 shadow-lg">
                            <span>üîç</span>
                            <span>Hint 25%</span>
                         </button>
                        <button id="addTime" onclick="addExtraTime()" class="bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white px-6 py-3 rounded-xl font-semibold flex items-center space-x-2 transition-all duration-200 transform hover:scale-105 shadow-lg">
                            <span>‚è∞</span>
                             <span>+30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</span>
                        </button>
                    </div>

                    <div class="text-center">
                        <button id="nextButton" onclick="nextQuestion()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-xl font-semibold disabled:bg-gray-400 disabled:cursor-not-allowed transition-all duration-200" disabled>
                            ‡∏Ç‡πâ‡∏≠‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí
                         </button>
                        <button id="submitButton" onclick="endQuiz()" class="bg-gradient-to-r from-red-500 to-pink-600 hover:from-red-600 hover:to-pink-700 text-white px-8 py-3 rounded-xl font-semibold disabled:bg-gray-400 disabled:cursor-not-allowed transition-all duration-200 transform hover:scale-105 hidden">
                            üìù ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö
                        </button>
                     </div>
                </div>
            </div>
        </div>
    </div>

    <div id="resultsScreen" class="hidden container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto bg-white rounded-2xl shadow-xl p-8">
             <div class="text-center mb-8">
                <div class="text-6xl mb-4" id="resultEmoji">üéâ</div>
                <h2 class="text-3xl font-bold text-indigo-600 mb-2">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</h2>
                <p class="text-gray-600">MATH ‡∏Å‡∏£‡∏¥‡πä‡∏á - ‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏≠‡∏ô‡∏∏‡∏û‡∏±‡∏ô‡∏ò‡πå</p>
            </div>

            <div class="bg-gradient-to-r from-gray-50 to-blue-50 p-6 rounded-xl mb-6 border border-gray-200">
                <div class="flex flex-col md:flex-row items-center justify-center md:space-x-8 text-lg space-y-2 md:space-y-0">
                    <div class="flex items-center">
                        <span class="text-2xl mr-2">üë§</span>
                         <span class="font-semibold text-gray-700">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•:</span>
                        <span class="ml-2 text-indigo-700 font-bold" id="resultStudentName">-</span>
                    </div>
                    <div class="flex items-center">
                         <span class="text-2xl mr-2">üè´</span>
                        <span class="font-semibold text-gray-700">‡∏´‡πâ‡∏≠‡∏á:</span>
                        <span class="ml-2 text-indigo-700 font-bold" id="resultStudentClass">-</span>
                    </div>
                    <div class="flex items-center">
                         <span class="text-2xl mr-2">üî¢</span>
                        <span class="font-semibold text-gray-700">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà:</span>
                        <span class="ml-2 text-indigo-700 font-bold" id="resultStudentNumber">-</span>
                    </div>
                 </div>
            </div>

            <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-xl mb-6">
                <div class="grid grid-cols-2 gap-4 text-center">
                    <div>
                         <div class="text-2xl font-bold text-blue-600" id="finalScore">8/10</div>
                        <div class="text-sm text-gray-600">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</div>
                    </div>
                    <div>
                         <div class="text-2xl font-bold text-green-600" id="bonusScore">+1.5</div>
                        <div class="text-sm text-gray-600">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÇ‡∏ö‡∏ô‡∏±‡∏™</div>
                    </div>
                </div>
            </div>

            <div class="space-y-4 mb-6" id="scoreBreakdown">
                 </div>

            <div id="wrongAnswersSection" class="mb-6">
                </div>

             <div class="bg-yellow-50 p-4 rounded-lg mb-6">
                <h4 class="font-semibold text-yellow-800 mb-2">üìù ‡∏Ñ‡∏≥‡∏ä‡∏µ‡πâ‡πÅ‡∏à‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h4>
                <p class="text-sm text-yellow-700">‡πÉ‡∏´‡πâ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ô‡∏≥‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏ó‡∏î‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ô‡∏µ‡πâ ‡∏™‡πà‡∏á‡∏Ñ‡∏£‡∏π‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£ MATH ‡∏Å‡∏£‡∏¥‡πä‡∏á - ‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏≠‡∏ô‡∏∏‡∏û‡∏±‡∏ô‡∏ò‡πå</p>
            </div>

            <div class="text-center">
                <div class="text-sm text-gray-500 mt-4">
                    <p>üì± ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡πÑ‡∏î‡πâ</p>
                </div>
                <div class="text-sm text-gray-500 mt-2">
                    <p id="timestamp"></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- START: EXPANDED AND CORRECTED QUESTION BANK (20 PER LEVEL) ---
        const questionBank = {
            easy: [
                { question: "f(x) = -20", choices: ["f'(x) = -20", "f'(x) = 1", "f'(x) = 0", "f'(x) = -1"], correct: 2, type: "constant" },
                { question: "f(x) = e^2", choices: ["f'(x) = 2e", "f'(x) = e^2", "f'(x) = 0", "f'(x) = 2"], correct: 2, type: "constant" },
                { question: "f(x) = 7 - x", choices: ["f'(x) = 7", "f'(x) = -1", "f'(x) = 1", "f'(x) = 0"], correct: 1, type: "linear" },
                { question: "f(x) = 12x", choices: ["f'(x) = 12", "f'(x) = 1", "f'(x) = 0", "f'(x) = 12x"], correct: 0, type: "linear" },
                { question: "f(x) = \\frac{x}{5}", choices: ["f'(x) = 5", "f'(x) = x", "f'(x) = \\frac{1}{5}", "f'(x) = 0"], correct: 2, type: "linear" },
                { question: "f(x) = 3(x - 2)", choices: ["f'(x) = 3x - 6", "f'(x) = 3", "f'(x) = 1", "f'(x) = 0"], correct: 1, type: "linear" },
                { question: "f(x) = \\pi x - 1", choices: ["f'(x) = \\pi - 1", "f'(x) = 1", "f'(x) = 0", "f'(x) = \\pi"], correct: 3, type: "linear" },
                { question: "f(x) = \\frac{1}{2}", choices: ["f'(x) = 1", "f'(x) = 2", "f'(x) = 0", "f'(x) = -\\frac{1}{4}"], correct: 2, type: "constant" },
                { question: "f(x) = 2^5", choices: ["f'(x) = 32", "f'(x) = 10", "f'(x) = 5(2)^4", "f'(x) = 0"], correct: 3, type: "constant" },
                { question: "f(x) = -x", choices: ["f'(x) = -1", "f'(x) = 1", "f'(x) = 0", "f'(x) = -x"], correct: 0, type: "linear" },
                { question: "f(x) = 1 - 8x", choices: ["f'(x) = 1", "f'(x) = -8x", "f'(x) = -7", "f'(x) = -8"], correct: 3, type: "linear" },
                { question: "f(x) = \\log(100)", choices: ["f'(x) = \\frac{1}{100}", "f'(x) = 2", "f'(x) = 0", "f'(x) = 10"], correct: 2, type: "constant" },
                { question: "f(x) = 0.5x + 3", choices: ["f'(x) = 3.5", "f'(x) = 0.5", "f'(x) = 3", "f'(x) = 0"], correct: 1, type: "linear" },
                { question: "f(x) = -15x", choices: ["f'(x) = -15", "f'(x) = 15", "f'(x) = 0", "f'(x) = -1"], correct: 0, type: "linear" },
                { question: "f(x) = 99", choices: ["f'(x) = 99", "f'(x) = 1", "f'(x) = 0", "f'(x) = 9"], correct: 2, type: "constant" },
                { question: "f(x) = 2024", choices: ["f'(x) = 2024", "f'(x) = 1", "f'(x) = 0", "f'(x) = 202.4"], correct: 2, type: "constant" },
                { question: "f(x) = 10x - 9", choices: ["f'(x) = 1", "f'(x) = 10", "f'(x) = -9", "f'(x) = 0"], correct: 1, type: "linear" },
                { question: "f(x) = -\\frac{2x}{3}", choices: ["f'(x) = -\\frac{2}{3}", "f'(x) = \\frac{2}{3}", "f'(x) = -2", "f'(x) = 0"], correct: 0, type: "linear" },
                { question: "f(x) = \\sqrt{17}", choices: ["f'(x) = \\frac{1}{2\\sqrt{17}}", "f'(x) = 17", "f'(x) = 1", "f'(x) = 0"], correct: 3, type: "constant" },
                { question: "f(x) = 5(1-x)", choices: ["f'(x) = 5", "f'(x) = -5", "f'(x) = 1", "f'(x) = 0"], correct: 1, type: "linear" }
            ],
            medium: [
                { question: "f(x) = 4x^3 - 5x^2", choices: ["f'(x) = 12x^2 - 10x", "f'(x) = 12x - 10", "f'(x) = 4x^2 - 5x", "f'(x) = 7x"], correct: 0, type: "polynomial" },
                { question: "f(x) = x^5 - 3x^4 + 9", choices: ["f'(x) = 5x^4 - 12x^3 + 9", "f'(x) = 5x^4 - 12x^3", "f'(x) = 4x^4 - 12x^3", "f'(x) = 20x^3 - 36x^2"], correct: 1, type: "polynomial" },
                { question: "f(x) = (2x+1)(x-3)", choices: ["f'(x) = 2", "f'(x) = 2x - 5", "f'(x) = 4x - 5", "f'(x) = 4x - 6"], correct: 2, type: "polynomial" },
                { question: "f(x) = \\frac{x^3+2x}{x}", choices: ["f'(x) = 3x^2+2", "f'(x) = 2x", "f'(x) = x^2+2", "f'(x) = 2x+2"], correct: 1, type: "polynomial" },
                { question: "f(x) = 5\\sqrt{x} - \\frac{1}{x}", choices: ["f'(x) = \\frac{5}{2\\sqrt{x}} + \\frac{1}{x^2}", "f'(x) = 5x^{1/2} + x^{-1}", "f'(x) = \\frac{5}{2\\sqrt{x}} - \\frac{1}{x^2}", "f'(x) = \\frac{5}{2}x^{-1/2} - x^{-2}"], correct: 0, type: "polynomial" },
                { question: "f(x) = 3x^{-2} + 4x - 1", choices: ["f'(x) = -6x^{-1} + 4", "f'(x) = -6x^{-3}", "f'(x) = -6x^{-3} + 4", "f'(x) = 6x^{-3} + 4"], correct: 2, type: "polynomial" },
                { question: "f(x) = x^2(x+4)", choices: ["f'(x) = 3x^2+8x", "f'(x) = 2x", "f'(x) = 2x+4", "f'(x) = 3x^2+4"], correct: 0, type: "polynomial" },
                { question: "f(x) = 8x^2 - \\sqrt[3]{x^2}", choices: ["f'(x) = 16x - \\frac{2}{3}x^{-\\frac{1}{3}}", "f'(x) = 16x - \\frac{2}{3}x^{\\frac{1}{3}}", "f'(x) = 16x - \\frac{3}{2}x^{-\\frac{1}{3}}", "f'(x) = 16x - 2x^{-\\frac{1}{3}}"], correct: 0, type: "polynomial" },
                { question: "f(x) = \\frac{1}{2}x^4 - x^3 + 5x", choices: ["f'(x) = 2x^3 - 3x^2 + 5", "f'(x) = 2x^4 - 3x^2 + 5", "f'(x) = 8x^3 - 3x^2 + 5", "f'(x) = 2x^3 - 3x + 5"], correct: 0, type: "polynomial" },
                { question: "f(x) = (x-1)(x+2)", choices: ["f'(x) = 2x", "f'(x) = 2x+1", "f'(x) = x+1", "f'(x) = 2x-1"], correct: 1, type: "polynomial" },
                { question: "f(x) = 10x^3 - 20x^2 + 30x - 40", choices: ["f'(x) = 30x^2 - 40x + 30", "f'(x) = 30x^2 - 40x", "f'(x) = 30x - 40", "f'(x) = 3x^2 - 4x + 3"], correct: 0, type: "polynomial" },
                { question: "f(x) = 2x^{\\frac{3}{2}} - x^{\\frac{1}{2}}", choices: ["f'(x) = 3x^{\\frac{1}{2}} - \\frac{1}{2}x^{-\\frac{1}{2}}", "f'(x) = 3x^{\\frac{1}{2}} + \\frac{1}{2}x^{-\\frac{1}{2}}", "f'(x) = 2x^{\\frac{1}{2}} - x^{-\\frac{1}{2}}", "f'(x) = 3x - \\frac{1}{2}"], correct: 0, type: "polynomial" },
                { question: "f(x) = \\frac{4}{x^3} + 3x^2", choices: ["f'(x) = 12x^{-4} + 6x", "f'(x) = -12x^{-2} + 6x", "f'(x) = -12x^{-4} + 6x", "f'(x) = -\\frac{12}{x^2} + 6x"], correct: 2, type: "polynomial" },
                { question: "f(x) = (x+5)^2", choices: ["f'(x) = 2x+10", "f'(x) = 2(x+5)^2", "f'(x) = x^2+25", "f'(x) = 2x+5"], correct: 0, type: "polynomial" },
                { question: "f(x) = 7x^3 - 2x + \\pi", choices: ["f'(x) = 21x^2-2", "f'(x) = 21x^2-2x+1", "f'(x) = 21x^2", "f'(x) = 21x-2"], correct: 0, type: "polynomial" },
                { question: "f(x) = x^3 - \\frac{1}{x^3}", choices: ["f'(x) = 3x^2 + 3x^{-4}", "f'(x) = 3x^2 - 3x^{-4}", "f'(x) = 3x^2 + 3x^{-2}", "f'(x) = 3x^2 - 3x^{-2}"], correct: 0, type: "polynomial" },
                { question: "f(x) = (3x-2)(2x+5)", choices: ["f'(x) = 12x + 11", "f'(x) = 6x+11", "f'(x) = 12x-11", "f'(x) = 12x+15"], correct: 0, type: "polynomial" },
                { question: "f(x) = 6x^2 - 3\\sqrt[3]{x}", choices: ["f'(x) = 12x - x^{\\frac{2}{3}}", "f'(x) = 12x - x^{-\\frac{2}{3}}", "f'(x) = 12x + x^{-\\frac{2}{3}}", "f'(x) = 12x - 3x^{-\\frac{2}{3}}"], correct: 1, type: "polynomial" },
                { question: "f(x) = \\frac{x^4-1}{x^2+1}", choices: ["f'(x) = 2x", "f'(x) = 4x^3", "f'(x) = 2x+1", "f'(x) = x^2-1"], correct: 0, type: "polynomial" },
                { question: "f(x) = 2x(x^2-3)", choices: ["f'(x) = 6x^2-6", "f'(x) = 4x-6", "f'(x) = 2x^2-6", "f'(x) = 6x-6"], correct: 0, type: "polynomial" }
            ],
            hard: [
                { question: "f(x) = (3x^2-1)(x+5)", choices: ["f'(x) = 9x^2 + 30x - 1", "f'(x) = 6x(x+5)+3x^2-1", "f'(x) = 6x^2+30x", "f'(x) = 9x^2+30x-x"], correct: 0, type: "product" },
                { question: "f(x) = x^2 \\sqrt{x+1}", choices: ["f'(x) = 2x\\sqrt{x+1} + \\frac{x^2}{2\\sqrt{x+1}}", "f'(x) = 2x(\\frac{1}{2\\sqrt{x+1}})", "f'(x) = \\frac{5x^2+4x}{2\\sqrt{x+1}}", "f'(x) = \\frac{4x^2+5x}{2\\sqrt{x+1}}"], correct: 2, type: "product" },
                { question: "f(x) = \\frac{4x}{x^2+1}", choices: ["f'(x) = \\frac{4-4x^2}{(x^2+1)^2}", "f'(x) = \\frac{4-8x^2}{(x^2+1)^2}", "f'(x) = \\frac{4}{2x}", "f'(x) = \\frac{4+4x^2}{(x^2+1)^2}"], correct: 0, type: "quotient" },
                { question: "f(x) = \\frac{x+3}{x-3}", choices: ["f'(x) = \\frac{-6}{(x-3)^2}", "f'(x) = \\frac{6}{(x-3)^2}", "f'(x) = 1", "f'(x) = \\frac{2x}{(x-3)^2}"], correct: 0, type: "quotient" },
                { question: "f(x) = (x^3-2x)^3", choices: ["f'(x) = 3(x^3-2x)^2", "f'(x) = 3(3x^2-2)^2", "f'(x) = 3(x^3-2x)^2 (3x^2-2)", "f'(x) = (3x^2-2)^3"], correct: 2, type: "composite" },
                { question: "f(x) = \\sqrt{5x^2+3}", choices: ["f'(x) = \\frac{1}{2\\sqrt{5x^2+3}}", "f'(x) = \\frac{10x}{\\sqrt{5x^2+3}}", "f'(x) = \\frac{5x}{\\sqrt{5x^2+3}}", "f'(x) = 10x(5x^2+3)^{-1/2}"], correct: 2, type: "composite" },
                { question: "f(x) = \\frac{1}{\\sqrt{x^2-1}}", choices: ["f'(x) = -x(x^2-1)^{-\\frac{3}{2}}", "f'(x) = x(x^2-1)^{-\\frac{3}{2}}", "f'(x) = -\\frac{1}{2}(x^2-1)^{-\\frac{3}{2}}", "f'(x) = (x^2-1)^{-3/2}"], correct: 0, type: "composite" },
                { question: "f(x) = x^2(x+1)^3", choices: ["f'(x) = 2x(3(x+1)^2)", "f'(x) = x(x+1)^2(5x+2)", "f'(x) = x(x+1)^2(2x+3)", "f'(x) = 2x(x+1)^3 + x^2"], correct: 1, type: "product" },
                { question: "f(x) = \\frac{x^2-1}{x^2+1}", choices: ["f'(x) = \\frac{4x}{(x^2+1)^2}", "f'(x) = \\frac{-4x}{(x^2+1)^2}", "f'(x) = \\frac{2x}{2x}", "f'(x) = \\frac{4x^3-4x}{(x^2+1)^2}"], correct: 0, type: "quotient" },
                { question: "f(x) = (2-3x^2)^4", choices: ["f'(x) = 4(2-3x^2)^3", "f'(x) = -24x(2-3x^2)^3", "f'(x) = -6x(2-3x^2)^3", "f'(x) = 12(2-3x^2)^3"], correct: 1, type: "composite" },
                { question: "f(x) = \\frac{1}{(2x+3)^2}", choices: ["f'(x) = -2(2x+3)^{-3}", "f'(x) = -4(2x+3)^{-1}", "f'(x) = -4(2x+3)^{-3}", "f'(x) = 4(2x+3)^{-3}"], correct: 2, type: "composite" },
                { question: "f(x) = (x^2+1)\\sqrt{x}", choices: ["f'(x) = 2x\\sqrt{x} + \\frac{x^2+1}{2\\sqrt{x}}", "f'(x) = \\frac{5x^2+1}{2\\sqrt{x}}", "f'(x) = \\frac{3x^2+1}{2\\sqrt{x}}", "f'(x) = 2x + \\frac{1}{2\\sqrt{x}}"], correct: 1, type: "product" },
                { question: "f(x) = \\sqrt[3]{x^2+1}", choices: ["f'(x) = \\frac{2x}{3(x^2+1)^{2/3}}", "f'(x) = \\frac{1}{3(x^2+1)^{2/3}}", "f'(x) = \\frac{2x}{3\\sqrt[3]{x^2+1}}", "f'(x) = \\frac{x}{3(x^2+1)^{2/3}}"], correct: 0, type: "composite" },
                { question: "f(x) = \\frac{\\sqrt{x}}{x+1}", choices: ["f'(x) = \\frac{1-x}{2\\sqrt{x}(x+1)^2}", "f'(x) = \\frac{1-2x}{2\\sqrt{x}(x+1)^2}", "f'(x) = \\frac{1}{\\sqrt{x}(x+1)^2}", "f'(x) = \\frac{1+x}{2\\sqrt{x}(x+1)^2}"], correct: 0, type: "quotient" },
                { question: "f(x) = x e^x", choices: ["f'(x) = e^x", "f'(x) = xe^x", "f'(x) = e^x(x+1)", "f'(x) = e^x+1"], correct: 2, type: "product" },
                { question: "f(x) = \\frac{e^x}{x}", choices: ["f'(x) = \\frac{e^x(x-1)}{x^2}", "f'(x) = e^x", "f'(x) = \\frac{e^x}{1}", "f'(x) = \\frac{e^x(x+1)}{x^2}"], correct: 0, type: "quotient" },
                { question: "f(x) = (\\ln x)^2", choices: ["f'(x) = 2\\ln x", "f'(x) = \\frac{2}{x}", "f'(x) = \\frac{2\\ln x}{x}", "f'(x) = \\frac{1}{x^2}"], correct: 2, type: "composite" },
                { question: "f(x) = \\sin(x^2)", choices: ["f'(x) = \\cos(x^2)", "f'(x) = 2x\\cos(x^2)", "f'(x) = 2\\sin x \\cos x", "f'(x) = -2x\\cos(x^2)"], correct: 1, type: "composite" },
                { question: "f(x) = x^2 \\cos x", choices: ["f'(x) = 2x\\cos x - x^2\\sin x", "f'(x) = -2x\\sin x", "f'(x) = 2x\\cos x + x^2\\sin x", "f'(x) = 2x(-\\sin x)"], correct: 0, type: "product" },
                { question: "f(x) = e^{3x+1}", choices: ["f'(x) = e^{3x+1}", "f'(x) = (3x+1)e^{3x}", "f'(x) = 3e^{3x+1}", "f'(x) = 3e^{3x}"], correct: 2, type: "composite" }
            ]
        };
        // --- END: EXPANDED AND CORRECTED QUESTION BANK (20 PER LEVEL) ---

        // Game state
        let currentQuestionIndex = 0;
        let selectedQuestions = [];
        let userAnswers = [];
        let timeRemaining = 90;
        let timerInterval;
        let globalHintsUsed = { hint50: false, hint25: false, addTime: false };
        let questionStartTime;
        let isQuizActive = false;
        let studentInfo = { name: '', class: '', number: '' };
        const motivationalQuotes = [
            "üí™ \"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏∏‡∏ç‡πÅ‡∏à‡∏™‡∏π‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏•‡∏∏‡∏¢‡πÄ‡∏•‡∏¢!\" üí™",
            "üöÄ \"‡∏≠‡∏ô‡∏∏‡∏û‡∏±‡∏ô‡∏ò‡πå‡πÑ‡∏°‡πà‡∏¢‡∏≤‡∏Å ‡πÅ‡∏Ñ‡πà‡∏ù‡∏∂‡∏Å‡∏ù‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡πà‡∏á!\" ÔøΩ",
            "‚≠ê \"‡∏ó‡∏∏‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏°‡∏≤ ‡∏à‡∏∞‡∏ô‡∏≥‡∏û‡∏≤‡∏™‡∏π‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\" ‚≠ê"
        ];
        // Anti-cheat system
        let tabSwitchCount = 0;
        let isAutoSubmitted = false;
        document.addEventListener('visibilitychange', () => {
            if (isQuizActive && document.hidden && !isAutoSubmitted) handleCheating();
        });
        window.addEventListener('blur', () => {
            if (isQuizActive && !isAutoSubmitted) handleCheating();
        });
        function handleCheating() {
            tabSwitchCount++;
            if (tabSwitchCount > 2) {
                isAutoSubmitted = true;
                autoSubmitQuiz();
            } else {
                regenerateCurrentQuestion();
                showCheatWarning();
            }
        }

        function regenerateCurrentQuestion() {
            if (currentQuestionIndex < selectedQuestions.length) {
                const currentType = selectedQuestions[currentQuestionIndex].type;
                let availableQuestions = Object.values(questionBank).flat().filter(q => q.type === currentType);
                const currentQuestionText = selectedQuestions[currentQuestionIndex].question;
                const otherQuestions = availableQuestions.filter(q => q.question !== currentQuestionText);
                if (otherQuestions.length > 0) {
                    selectedQuestions[currentQuestionIndex] = otherQuestions[Math.floor(Math.random() * otherQuestions.length)];
                    delete userAnswers[currentQuestionIndex];
                    setTimeout(showQuestion, 1000);
                }
            }
        }

        function showCheatWarning() {
            document.getElementById('cheatWarning').classList.remove('hidden');
        }

        function hideCheatWarning() {
            document.getElementById('cheatWarning').classList.add('hidden');
        }

        function autoSubmitQuiz() {
            isQuizActive = false;
            clearInterval(timerInterval);
            const warningDiv = document.getElementById('cheatWarning');
            warningDiv.innerHTML = `<div class="text-center p-8"><div class="text-6xl mb-4">üö®</div><h2 class="text-2xl font-bold mb-4">‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥!</h2><p class="text-lg">‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏Å‡∏¥‡∏ô 2 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p></div>`;
            warningDiv.classList.remove('hidden');
            setTimeout(() => {
                warningDiv.classList.add('hidden');
                endQuiz(true);
            }, 3000);
        }

        function generateQuestions() {
            const easy = shuffleArray([...questionBank.easy]).slice(0, 3);
            const medium = shuffleArray([...questionBank.medium]).slice(0, 4);
            const hard = shuffleArray([...questionBank.hard]).slice(0, 3);
            selectedQuestions = [...easy, ...medium, ...hard];
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function formatMathExpression(expression, displayMode = false) {
            try {
                if (typeof katex !== 'undefined') {
                    return katex.renderToString(expression, {
                        throwOnError: false,
                         displayMode: displayMode
                    });
                }
                return expression;
            } catch (e) {
                console.error("KaTeX rendering error:", e);
                return expression;
            }
        }

        function playBellSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const now = audioContext.currentTime;

                const buzz = audioContext.createOscillator();
                buzz.type = 'sawtooth';
                buzz.frequency.setValueAtTime(160, now);
                buzz.frequency.exponentialRampToValueAtTime(100, now + 0.2);
                const gainNode = audioContext.createGain();
                gainNode.gain.setValueAtTime(0.3, now);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.3);

                const ping = audioContext.createOscillator();
                ping.type = 'sine';
                ping.frequency.setValueAtTime(880, now);
                ping.frequency.exponentialRampToValueAtTime(440, now + 0.25);

                const pingGain = audioContext.createGain();
                pingGain.gain.setValueAtTime(0.2, now);
                pingGain.gain.exponentialRampToValueAtTime(0.01, now + 0.25);

                buzz.connect(gainNode);
                ping.connect(pingGain);
                gainNode.connect(audioContext.destination);
                pingGain.connect(audioContext.destination);

                buzz.start(now);
                ping.start(now);
                buzz.stop(now + 0.4);
                ping.stop(now + 0.4);

            } catch (error) {
                console.log('Audio not supported or failed to play:', error);
            }
        }

        function startQuiz() {
            const name = document.getElementById('studentName').value.trim();
            const sClass = document.getElementById('studentClass').value.trim();
            const sNumber = document.getElementById('studentNumber').value.trim();
            
            if (!name || !sClass || !sNumber) {
                const startBtn = document.getElementById('startQuizBtn');
                startBtn.textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô!';
                startBtn.classList.add('bg-red-500');
                setTimeout(() => {
                    startBtn.textContent = 'üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö';
                    startBtn.classList.remove('bg-red-500');
                }, 2000);
                return;
            }

            studentInfo = { name, class: sClass, number: sNumber };
            generateQuestions();
            document.getElementById('welcomeScreen').classList.add('hidden');
            document.getElementById('quizScreen').classList.remove('hidden');
            document.getElementById('studentInfo').textContent = `${name} ‡∏´‡πâ‡∏≠‡∏á ${sClass} ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà ${sNumber}`;
            isQuizActive = true;
            currentQuestionIndex = 0;
            userAnswers = [];
            globalHintsUsed = { hint50: false, hint25: false, addTime: false };
            showQuestion();
        }
        
        function setRandomQuote() {
            const quoteEl = document.getElementById('motivationalQuote');
            quoteEl.textContent = motivationalQuotes[Math.floor(Math.random() * motivationalQuotes.length)];
        }

        function addExtraTime() {
            if (globalHintsUsed.addTime) return;
            globalHintsUsed.addTime = true;
            timeRemaining += 30;
            updateTimerDisplay();
            document.getElementById('addTime').style.display = 'none';
        }

        function showQuestion() {
            if (currentQuestionIndex >= selectedQuestions.length) {
                endQuiz();
                return;
            }

            const question = selectedQuestions[currentQuestionIndex];
            questionStartTime = Date.now();
            document.getElementById('questionNumber').textContent = `${currentQuestionIndex + 1}/10`;
            document.getElementById('progressBar').style.width = `${(currentQuestionIndex + 1) * 10}%`;
            document.getElementById('questionText').innerHTML = formatMathExpression(question.question, true);
            const emojis = { constant: 'üî¢', linear: 'üìè', polynomial: 'üìà', product: '‚úñÔ∏è', quotient: '‚ûó', composite: 'üîó' };
            document.getElementById('questionEmoji').textContent = emojis[question.type] || 'ü§î';
            
            const choices = question.choices;
            const correct = question.correct;
            const indices = shuffleArray([0, 1, 2, 3]);
            selectedQuestions[currentQuestionIndex].shuffledChoices = indices.map(i => choices[i]);
            selectedQuestions[currentQuestionIndex].shuffledCorrect = indices.indexOf(correct);
            
            const choicesContainer = document.getElementById('answerChoices');
            choicesContainer.innerHTML = '';
            selectedQuestions[currentQuestionIndex].shuffledChoices.forEach((choice, index) => {
                const button = document.createElement('button');
                button.className = 'choice-btn flex items-center w-full p-4 text-left border-2 border-gray-200 rounded-xl hover:border-indigo-400 hover:bg-indigo-50 transition-all duration-300 transform hover:scale-[1.02]';
                button.innerHTML = `<span class="flex-shrink-0 w-8 h-8 bg-indigo-100 text-indigo-700 rounded-full text-center leading-8 font-bold mr-3">${String.fromCharCode(65 + index)}</span><div class="math-display text-gray-800">${formatMathExpression(choice)}</div>`;
                 button.onclick = () => selectAnswer(index);
                button.id = `choice-${index}`;
                choicesContainer.appendChild(button);
            });
            updateHintButtons();
            
            const nextButton = document.getElementById('nextButton');
            const submitButton = document.getElementById('submitButton');
            
            if (currentQuestionIndex === selectedQuestions.length - 1) {
                nextButton.classList.add('hidden');
                submitButton.classList.remove('hidden');
                submitButton.disabled = true;
            } else {
                nextButton.classList.remove('hidden');
                submitButton.classList.add('hidden');
                nextButton.disabled = true;
            }
            
            timeRemaining = 90;
            startTimer();
        }
        
        function updateHintButtons() {
            document.getElementById('hint50').style.display = globalHintsUsed.hint50 ?
'none' : 'flex';
            document.getElementById('hint25').style.display = globalHintsUsed.hint25 ? 'none' : 'flex';
            document.getElementById('addTime').style.display = globalHintsUsed.addTime ? 'none' : 'flex';
        }

        function startTimer() {
            clearInterval(timerInterval);
            updateTimerDisplay();
            timerInterval = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                if (timeRemaining <= 0) timeUp();
            }, 1000);
        }

        function updateTimerDisplay() {
            const timerEl = document.getElementById('timer');
            timerEl.textContent = timeRemaining;
            timerEl.classList.toggle('timer-warning', timeRemaining <= 10);
            timerEl.classList.toggle('text-orange-300', timeRemaining <= 30 && timeRemaining > 10);
            timerEl.classList.toggle('animate-pulse', timeRemaining <= 30);
        }

        function selectAnswer(answerIndex) {
            document.querySelectorAll('.choice-btn').forEach(btn => btn.classList.remove('border-green-500', 'bg-green-100'));
            document.getElementById(`choice-${answerIndex}`).classList.add('border-green-500', 'bg-green-100');
            
            const question = selectedQuestions[currentQuestionIndex];
            userAnswers[currentQuestionIndex] = {
                selected: answerIndex,
                correct: question.shuffledCorrect,
                timeUsed: Math.round((Date.now() - questionStartTime) / 1000),
            };

            if (currentQuestionIndex === selectedQuestions.length - 1) {
                document.getElementById('submitButton').disabled = false;
            } else {
                document.getElementById('nextButton').disabled = false;
            }
        }

        function useHint(percentage) {
            const { shuffledCorrect } = selectedQuestions[currentQuestionIndex];
            const choices = document.querySelectorAll('.choice-btn');
            const disableChoice = el => {
                el.classList.add('opacity-20', 'pointer-events-none');
                el.onclick = null;
            };

            if (percentage === 50 && !globalHintsUsed.hint50) {
                globalHintsUsed.hint50 = true;
                let removed = 0;
                choices.forEach((choice, i) => {
                    if (i !== shuffledCorrect && removed < 2) {
                        disableChoice(choice);
                        removed++;
                     }
                });
            } else if (percentage === 25 && !globalHintsUsed.hint25) {
                globalHintsUsed.hint25 = true;
                for (let i = 0; i < choices.length; i++) {
                    if (i !== shuffledCorrect && !choices[i].classList.contains('opacity-20')) {
                        disableChoice(choices[i]);
                        break;
                    }
                }
            }
            updateHintButtons();
        }

        function timeUp() {
            clearInterval(timerInterval);
            playBellSound();
            if (!userAnswers[currentQuestionIndex]) {
                const timeUsed = Math.round((Date.now() - questionStartTime) / 1000);
                userAnswers[currentQuestionIndex] = { selected: -1, correct: selectedQuestions[currentQuestionIndex].shuffledCorrect, timeUsed: timeUsed };
            }
            document.getElementById('questionCard').classList.add('fade-out');
            setTimeout(() => {
                document.getElementById('questionCard').classList.remove('fade-out');
                nextQuestion();
            }, 1000);
        }

        function nextQuestion() {
            if (currentQuestionIndex >= selectedQuestions.length - 1) {
                endQuiz();
            } else {
                currentQuestionIndex++;
                showQuestion();
            }
        }

        function endQuiz(isAutoSubmit = false) {
            isQuizActive = false;
            clearInterval(timerInterval);
            document.getElementById('quizScreen').classList.add('hidden');
            document.getElementById('resultsScreen').classList.remove('hidden');
            calculateAndShowResults(isAutoSubmit);
        }

        function calculateAndShowResults(isAutoSubmitted = false) {
            let correctAnswers = userAnswers.filter(a => a && a.selected === a.correct).length;
            let totalTimeUsed = userAnswers.reduce((acc, a) => acc + (a ? a.timeUsed : 0), 0);
            let answeredQuestions = userAnswers.filter(a => a).length;
            let averageTime = answeredQuestions > 0 ? totalTimeUsed / answeredQuestions : 0;
            let noHintsUsed = !globalHintsUsed.hint50 && !globalHintsUsed.hint25 && !globalHintsUsed.addTime;
            let bonusScore = 0;

            if (!isAutoSubmitted && noHintsUsed && answeredQuestions === 10) {
                if (averageTime <= 45) bonusScore = 2;
                else if (averageTime <= 60) bonusScore = 1.5;
                else if (averageTime <= 75) bonusScore = 1;
                else if (averageTime <= 85) bonusScore = 0.5;
                if (correctAnswers === 10) bonusScore += 0.5;
            }
            
            document.getElementById('finalScore').textContent = `${correctAnswers}/10`;
            document.getElementById('bonusScore').textContent = `+${bonusScore.toFixed(1)}`;
            document.getElementById('resultStudentName').textContent = studentInfo.name;
            document.getElementById('resultStudentClass').textContent = studentInfo.class;
            document.getElementById('resultStudentNumber').textContent = studentInfo.number;
            
            const percentage = correctAnswers * 10;
            document.getElementById('resultEmoji').textContent = percentage >= 90 ? 'üèÜ' : percentage >= 70 ? 'üéâ' : percentage >= 50 ?
'üëè' : 'üí™';
            
            const breakdown = document.getElementById('scoreBreakdown');
            breakdown.innerHTML = `<div class="bg-blue-50 p-6 rounded-xl"><h4 class="font-bold text-lg mb-4">üìä ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h4>${isAutoSubmitted ?
'<p class="text-red-600 mb-2">üö® ‡∏™‡πà‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡∏™‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠)</p>' : ''}<div class="grid md:grid-cols-2 gap-4 text-sm"><div><p>‚úÖ ‡∏ñ‡∏π‡∏Å: ${correctAnswers}</p><p>‚ùå ‡∏ú‡∏¥‡∏î: ${answeredQuestions - correctAnswers}</p><p>‚ö™ ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏≥: ${10 - answeredQuestions}</p><p>‚è±Ô∏è ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢: ${Math.round(averageTime)} ‡∏ß‡∏¥/‡∏Ç‡πâ‡∏≠</p></div><div><p>üí° Hint: ${noHintsUsed ?
'‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ' : '‡πÉ‡∏ä‡πâ'}</p><p>üèÜ ‡πÇ‡∏ö‡∏ô‡∏±‡∏™: +${bonusScore.toFixed(1)}</p><p class="font-bold mt-2 border-t pt-2">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°: ${(correctAnswers + bonusScore).toFixed(1)}/10</p></div></div></div>`;

            const wrongAnswersSection = document.getElementById('wrongAnswersSection');
            const wrongAnswers = userAnswers
                .map((answer, index) => ({ answer, index }))
                .filter(item => item.answer && item.answer.selected !== -1 && item.answer.selected !== item.answer.correct);
            if(wrongAnswers.length > 0) {
                wrongAnswersSection.innerHTML = `<div class="bg-red-50 p-6 rounded-xl"><h4 class="font-bold text-lg mb-4 text-red-800">‚ùå ‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î</h4><div class="space-y-4">${wrongAnswers.map(item => {
                    const q = selectedQuestions[item.index];
                    const selected = item.answer.selected >= 0 ? q.shuffledChoices[item.answer.selected] : '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å';
                    const correct = q.shuffledChoices[item.answer.correct];
                    return `<div class="bg-white p-3 rounded-lg"><p class="font-semibold">‡∏Ç‡πâ‡∏≠ ${item.index + 1}: ${formatMathExpression(q.question)}</p><p class="text-red-600">‡∏ï‡∏≠‡∏ö: ${formatMathExpression(selected)}</p><p class="text-green-600">‡πÄ‡∏â‡∏•‡∏¢: ${formatMathExpression(correct)}</p></div>`;
                }).join('')}</div></div>`;
            } else if (correctAnswers === 10) {
                wrongAnswersSection.innerHTML = `<div class="bg-green-50 p-6 rounded-xl text-center"><h4 class="font-bold text-lg text-green-800">üéâ Perfect Score!</h4></div>`;
            } else {
                 wrongAnswersSection.innerHTML = '';
            }
            
            const options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit' };
            document.getElementById('timestamp').textContent = `‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏• ‡∏ì ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${new Date().toLocaleDateString('th-TH', options)}`;
        }

        document.addEventListener('DOMContentLoaded', () => {
            const katexScript = document.querySelector('script[src*="katex.min.js"]');

            const initializeApp = () => {
                setRandomQuote();
                document.getElementById('startQuizBtn').addEventListener('click', startQuiz);
            };

            const handleInitError = () => {
                console.error("KaTeX library failed to load. The quiz cannot start.");
                const startBtn = document.getElementById('startQuizBtn');
                if (startBtn) {
                    startBtn.disabled = true;
                    startBtn.textContent = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ';
                    startBtn.classList.remove('from-indigo-500', 'to-purple-600');
                    startBtn.classList.add('bg-red-600', 'cursor-not-allowed');
                }
            };

            // Check if KaTeX is already loaded
            if (window.katex) {
                initializeApp();
            } else if (katexScript) {
                // If not loaded, wait for the script to load or error out.
                katexScript.onload = initializeApp;
                katexScript.onerror = handleInitError;
            } else {
                // If the script tag itself isn't found in the DOM.
                handleInitError();
            }
            
            document.addEventListener('contextmenu', e => isQuizActive && e.preventDefault());
            document.addEventListener('keydown', e => {
                if (isQuizActive && (e.key === 'F12' || (e.ctrlKey && e.shiftKey))) e.preventDefault();
            });
        });
    </script>
</body>
</html>
ÔøΩ
